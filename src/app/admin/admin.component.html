<app-header [hasDot]="false" [hasNavbarMenu]="false"></app-header>

<!-- Login info and logout button -->
<div id="login-info" class="px-4 pt-4 d-flex justify-content-between align-items-center"
     *ngIf="isAuthenticated$ | async">
  <span>Logged in as: {{ userEmail$ | async }}</span>
  <button class="btn btn-outline-secondary ml-2" (click)="logout()">Log out</button>
</div>

<!-- Subscriptions summary -->
<div id="subscriptions-wrapper" class="d-flex justify-content-around">
  <div id="subscriptions-summary-card" class="card my-5">
    <div class="card-body">

      <!-- Title -->
      <h1 class="typo-admin-title py-4">Newsletter subscriptions</h1>

      <!-- Subtitle: summary of the subscriptions -->
      <h2 *ngIf="newsletterSubscriptionsSummary" class="typo-admin-subtitle d-flex justify-content-between py-2">
        <span>{{ newsletterSubscriptionsSummary }}</span>
        <button class="btn btn-outline-secondary" (click)="exportAsCsv()">Export as CSV</button>
      </h2>

      <!-- Login form - if user is not authenticated -->
      <div *ngIf="(isAuthenticated$ | async) === false" class="text-center">
        <p class="mt-3">Please log in to access this content:</p>
        <!-- Email -->
        <mat-form-field appearance="fill" class="m-1">
          <mat-label>Email</mat-label>
          <input matInput placeholder="toto@titi.com" [(ngModel)]="email">
        </mat-form-field>
        <!-- Password -->
        <mat-form-field appearance="fill" class="m-1">
          <mat-label>Password</mat-label>
          <input matInput [type]="hidePassword ? 'password' : 'text'" [(ngModel)]="password">
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword">
            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </mat-form-field>
        <!-- Login button -->
        <p>
          <button class="btn btn-outline-secondary" (click)="login()">Log in</button>
        </p>
        <!-- Login error if any -->
        <p class="mat-error" *ngIf="loginErrorMessage">{{ loginErrorMessage }}</p>
      </div>

      <!-- Newsletter subscriptions - if user is authenticated -->
      <div *ngIf="(isAuthenticated$ | async) && (newsletterSubscriptions$ | async)">
        <div *ngFor="let subscription of newsletterSubscriptions$ | async">
          <hr>
          <div class="subscription row">
            <span class="col">{{ subscription.email }}</span>
            <span class="col">subscribed on {{ subscription.subscriptionDate.formatted }}</span>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

